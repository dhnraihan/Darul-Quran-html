<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Daarul Quran ‚Äî ‡¶¨‡¶á‡¶∏‡¶Æ‡ßÇ‡¶π</title>

  <!-- Tailwind (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá ‡¶Ü‡¶ó‡ßá ‡¶•‡ßá‡¶ï‡ßá‡¶á ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶è‡¶ü‡¶æ‡¶§‡ßá ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶®‡ßá‡¶á) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ó‡ßç‡¶≤‡ßã‡¶¨‡¶æ‡¶≤ CSS/JS (index.html ‡¶è ‡¶Ø‡ßá‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶õ‡ßá ‡¶∏‡ßá‡¶≠‡¶æ‡¶¨‡ßá‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶®) -->
  <!-- <link rel="stylesheet" href="assets/styles.css" /> -->

  <style>
    /* Optional helpers (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶ú‡ßá‡¶ï‡ßç‡¶ü‡ßá ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶¨‡¶æ‡¶¶ ‡¶¶‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®) */
    .islamic-pattern { pointer-events: none; background-image: radial-gradient(rgba(255,255,255,0.04) 1px, transparent 1px); background-size: 24px 24px; }
    .chip { @apply px-3 py-1 rounded-full text-sm border transition-all cursor-pointer; }
    .chip-active { @apply bg-emerald-600 text-white border-emerald-400; }
    .chip-idle { @apply bg-white/5 text-emerald-100/80 border-emerald-500/20 hover:border-emerald-400/40; }
    .btn { @apply inline-flex items-center justify-center px-3 py-2 rounded-lg text-sm font-semibold transition-all; }
    .btn-ghost { @apply bg-white/10 border border-emerald-500/20 text-white hover:bg-white/15; }
    .btn-primary { @apply bg-gradient-to-r from-emerald-500 to-emerald-600 text-white hover:shadow-lg hover:shadow-emerald-500/25; }
    .badge { @apply text-[11px] px-2 py-0.5 rounded-full border; }
    .badge-amber { @apply bg-amber-500/10 border-amber-500/30 text-amber-300; }
    .badge-emerald { @apply bg-emerald-500/10 border-emerald-500/30 text-emerald-300; }
    .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
    .line-clamp-3 { display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }

    /* Reader Modal */
    .modal-backdrop { @apply fixed inset-0 bg-black/70 backdrop-blur-sm z-50 hidden; }
    .modal-backdrop.active { @apply block; }
  </style>
</head>
<body class="bg-gradient-to-b from-[#022c22] to-[#064e3b] min-h-screen">

  <!-- Navigation -->
  <nav class="fixed top-0 w-full z-50 backdrop-blur-md bg-[#022c22]/80 border-b border-emerald-800/20">
    <div class="container mx-auto px-4 py-4">
      <div class="flex justify-between items-center">
        <div class="flex items-center gap-2">
          <a href="index.html" class="flex items-center gap-2">
            <img src="daarulquran.webp" class="w-[52px]" alt="">
            <span class="text-white font-semibold text-lg">Daarul Quran</span>
          </a>
        </div>

        <div class="hidden lg:flex items-center gap-6">
          <a href="index.html" class="text-emerald-100/70 hover:text-white transition">‡¶π‡ßã‡¶Æ</a>
          <a href="index.html#courses" class="text-emerald-100/70 hover:text-white transition">‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶∏‡¶Æ‡ßÇ‡¶π</a>
          <a href="books.html" class="text-white font-semibold">‡¶¨‡¶á‡¶∏‡¶Æ‡ßÇ‡¶π</a>
          <a href="#contact" class="px-4 py-2 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-full hover:shadow-lg hover:shadow-emerald-500/25 transition">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
        </div>

        <button id="mobileMenuBtn" class="lg:hidden text-white p-2" aria-label="Menu">
          <svg id="menuIcon" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <svg id="closeIcon" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="lg:hidden hidden">
      <div class="container mx-auto px-4 py-4 bg-[#022c22]/95 backdrop-blur-lg border-t border-emerald-800/20">
        <div class="flex flex-col space-y-4">
          <a href="index.html" class="text-emerald-100/70 hover:text-white transition py-2 border-b border-emerald-800/10">‡¶π‡ßã‡¶Æ</a>
          <a href="index.html#courses" class="text-emerald-100/70 hover:text-white transition">‡¶ï‡ßã‡¶∞‡ßç‡¶∏‡¶∏‡¶Æ‡ßÇ‡¶π</a>
          <a href="books.html" class="text-white">‡¶¨‡¶á‡¶∏‡¶Æ‡ßÇ‡¶π</a>
          <a href="#contact" class="w-full py-3 text-center bg-gradient-to-r from-emerald-500 to-emerald-600 text-white rounded-full hover:shadow-lg hover:shadow-emerald-500/25 transition mt-2">‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</a>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="relative pt-28 pb-10">
    <div class="absolute inset-0 islamic-pattern opacity-20"></div>
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto text-center">
        <div class="inline-flex items-center gap-3 px-4 py-2 rounded-full bg-emerald-900/30 backdrop-blur-sm border border-emerald-500/20 mb-4">
          <span class="arabic-font text-amber-400 text-xl">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸéŸëŸáŸê</span>
          <span class="text-emerald-200 text-sm">‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡¶æ‡¶≤ ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶≤‡¶æ‡¶á‡¶¨‡ßç‡¶∞‡ßá‡¶∞‡¶ø</span>
        </div>
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-3">
          ‡¶¨‡¶á‡¶∏‡¶Æ‡ßÇ‡¶π ‚Äî Islamic Library
        </h1>
        <p class="text-emerald-100/70 max-w-2xl mx-auto">
          ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®, ‡¶§‡¶æ‡¶ú‡¶¨‡ßÄ‡¶¶, ‡¶ï‡¶ø‡¶∞‡¶æ‡¶§, ‡¶¶‡ßã‚Äò‡¶Ü, ‡¶Ü‡¶∞‡¶¨‡¶ø ‡¶≠‡¶æ‡¶∑‡¶æ‚Äî ‡¶∏‡¶¨ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶è‡¶ï ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü‡•§ ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö, ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ì ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶∞‡¶ø‡¶°‡¶æ‡¶∞‡¶∏‡¶π‡•§
        </p>
      </div>

      <!-- Search + Filters -->
      <div class="mt-8 bg-white/5 backdrop-blur-sm border border-emerald-500/20 rounded-2xl p-4 md:p-6">
        <div class="flex flex-col md:flex-row gap-3 md:items-center">
          <div class="flex-1 relative">
            <input id="searchInput" type="text" placeholder="‡¶¨‡¶á ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶® (‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ/‡¶≤‡ßá‡¶ñ‡¶ï/‡¶ü‡ßç‡¶Ø‡¶æ‡¶ó)..."
                   class="w-full px-4 py-3 bg-emerald-900/30 border border-emerald-500/30 rounded-lg text-white placeholder-emerald-200/50 focus:outline-none focus:border-emerald-400 focus:bg-emerald-900/40 transition-all">
            <span class="absolute right-3 top-1/2 -translate-y-1/2 text-emerald-300/70">‚åï</span>
          </div>

          <div class="flex gap-2">
            <select id="languageSelect" class="px-3 py-3 bg-emerald-900/30 border border-emerald-500/30 rounded-lg text-emerald-100 focus:border-emerald-400">
              <option value="All">‡¶≠‡¶æ‡¶∑‡¶æ: ‡¶∏‡¶¨</option>
              <option value="Bangla">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
              <option value="Arabic">‡¶Ü‡¶∞‡¶¨‡¶ø</option>
              <option value="English">‡¶á‡¶Ç‡¶∞‡ßá‡¶ú‡¶ø</option>
            </select>
            <select id="sortSelect" class="px-3 py-3 bg-emerald-900/30 border border-emerald-500/30 rounded-lg text-emerald-100 focus:border-emerald-400">
              <option value="Newest">‡¶∏‡¶∞‡ßç‡¶¨‡¶®‡¶§‡ßÅ‡¶®</option>
              <option value="AZ">A‚ÄìZ</option>
              <option value="Popular">Most Downloaded</option>
            </select>
          </div>
        </div>

        <!-- Category Chips -->
        <div class="flex flex-wrap gap-2 mt-4">
          <button class="chip chip-active" data-category="All">‡¶∏‡¶¨</button>
          <button class="chip chip-idle" data-category="Quran">‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶®</button>
          <button class="chip chip-idle" data-category="Tajweed">‡¶§‡¶æ‡¶ú‡¶¨‡ßÄ‡¶¶</button>
          <button class="chip chip-idle" data-category="Qiraat">‡¶ï‡ßç‡¶¨‡ßá‡¶∞‡¶æ‡¶§</button>
          <button class="chip chip-idle" data-category="Dua">‡¶¶‡ßã‚Äò‡¶Ü</button>
          <button class="chip chip-idle" data-category="Arabic">‡¶Ü‡¶∞‡¶¨‡¶ø ‡¶≠‡¶æ‡¶∑‡¶æ</button>
          <button class="chip chip-idle" data-category="Kids">‡¶∂‡¶ø‡¶∂‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶¨‡¶á</button>
          <button class="chip chip-idle" data-category="Hifz">‡¶π‡¶ø‡¶´‡¶Ø</button>
        </div>
      </div>
    </div>
  </section>

  <!-- Books Grid -->
  <section class="relative pb-16">
    <div class="container mx-auto px-4">
      <div id="statsBar" class="flex flex-wrap gap-4 items-center justify-between mb-4 text-sm text-emerald-200/70">
        <div>‡¶Æ‡ßã‡¶ü ‡¶¨‡¶á: <span id="totalCount">0</span></div>
        <div>‡¶™‡ßá‡¶ú: <span id="pageInfo">1/1</span></div>
      </div>

      <div id="bookGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden text-center py-20">
        <div class="text-6xl mb-3">üìö</div>
        <h3 class="text-white text-xl font-semibold mb-2">‡¶ï‡ßã‡¶®‡ßã ‡¶¨‡¶á ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø</h3>
        <p class="text-emerald-200/70">‡¶∏‡¶æ‡¶∞‡ßç‡¶ö/‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
      </div>

      <!-- Pagination -->
      <div class="flex items-center justify-center gap-2 mt-8">
        <button id="prevBtn" class="btn btn-ghost border-emerald-500/30" disabled>‚Äπ ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡ßá‡¶∞</button>
        <div id="pageButtons" class="flex items-center gap-1"></div>
        <button id="nextBtn" class="btn btn-ghost border-emerald-500/30">‡¶™‡¶∞‡ßá‡¶∞ ‚Ä∫</button>
      </div>
    </div>
  </section>

  <!-- Reader Modal -->
  <div id="readerModal" class="modal-backdrop">
    <div class="relative max-w-6xl mx-auto bg-[#022c22] border border-emerald-500/30 rounded-2xl mt-16 overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 border-b border-emerald-500/20">
        <div class="flex items-center gap-2">
          <span class="text-emerald-300">üìñ</span>
          <h4 id="readerTitle" class="text-white font-semibold"></h4>
        </div>
        <button id="closeReader" class="btn btn-ghost">‚úï</button>
      </div>
      <div class="relative h-[70vh] bg-emerald-950/40">
        <div id="readerLoader" class="absolute inset-0 flex items-center justify-center">
          <div class="w-10 h-10 rounded-full border-2 border-emerald-400 border-t-transparent animate-spin"></div>
        </div>
        <iframe id="readerFrame" class="w-full h-full" style="display:none;" loading="lazy"></iframe>
      </div>
      <div class="flex items-center justify-between px-4 py-3 border-t border-emerald-500/20 text-sm">
        <div class="text-emerald-200/70">PDF viewer</div>
        <a id="downloadFromModal" class="btn btn-primary" href="#" download>‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</a>
      </div>
    </div>
  </div>

  <!-- Footer (‡¶≤‡¶æ‡¶á‡¶ü ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶®) -->
  <footer class="relative py-10 bg-[#011a14] border-t border-emerald-800/20">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center gap-2">
          <div class="w-9 h-9 bg-gradient-to-br from-emerald-500 to-emerald-700 rounded-lg flex items-center justify-center">
            <span class="arabic-font text-white text-lg">ŸÇ</span>
          </div>
          <span class="text-white font-semibold">Daarul Quran</span>
        </div>
        <div class="text-emerald-200/50 text-sm">¬© ‡ß®‡ß¶‡ß®‡ß´ Daarul Quran ‚Äî ‡¶¨‡¶á‡¶∏‡¶Æ‡ßÇ‡¶π</div>
        <div class="flex gap-4 text-sm">
          <a href="#" class="text-emerald-200/50 hover:text-emerald-300">‡¶∂‡¶∞‡ßç‡¶§‡¶æ‡¶¨‡¶≤‡ßÄ</a>
          <a href="#" class="text-emerald-200/50 hover:text-emerald-300">‡¶™‡ßç‡¶∞‡¶æ‡¶á‡¶≠‡ßá‡¶∏‡¶ø</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Dummy data (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡ßü ‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡ßá‡¶∏ ‡¶ï‡¶∞‡ßÅ‡¶® / JSON ‡¶•‡ßá‡¶ï‡ßá ‡¶´‡ßá‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®)
    const books = [
      { id:1, title:"‡¶∏‡¶π‡¶ø‡¶π ‡¶ï‡¶ø‡¶∞‡¶æ‡¶§ ‡¶∏‡¶π ‡¶ï‡ßÅ‡¶∞‡¶Ü‡¶® (‡¶§‡¶æ‡¶ú‡¶¨‡ßÄ‡¶¶)", author:"Daarul Quran", category:"Quran", language:"Arabic", pages:604, sizeMB:35, year:2022, downloads:12000,
        cover:"covers/tajweed-mushaf.webp", pdf:"books/tajweed-mushaf.pdf", tags:["Quran","Tajweed","Khat"], featured:true },
      { id:2, title:"‡¶®‡ßÇ‡¶∞‡¶æ‡¶®‡ßÄ ‡¶ï‡¶æ‡ßü‡¶¶‡¶æ (‡¶∂‡¶ø‡¶∂‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)", author:"DQ Kids", category:"Kids", language:"Bangla", pages:64, sizeMB:9.1, year:2024, downloads:5800,
        cover:"covers/nurani.webp", pdf:"books/nurani.pdf", tags:["Kids","Noorani","Beginner"], badge:"‡¶®‡¶§‡ßÅ‡¶®" },
      { id:3, title:"‡¶∏‡¶π‡¶ø‡¶π ‡¶§‡¶æ‡¶ú‡¶¨‡ßÄ‡¶¶ (‡¶™‡ßç‡¶∞‡¶æ‡¶•‡¶Æ‡¶ø‡¶ï ‡¶ó‡¶æ‡¶á‡¶°)", author:"Ustaz Ahmad", category:"Tajweed", language:"Bangla", pages:120, sizeMB:12, year:2023, downloads:4200,
        cover:"covers/tajweed-basic.webp", pdf:"books/tajweed-basic.pdf", tags:["Tajweed","Makharij","Rules"] },
      { id:4, title:"‡¶Æ‡¶æ‡¶∏‡¶®‡ßÇ‡¶® ‡¶¶‡ßã‚Äò‡¶Ü ‡¶∏‡¶Æ‡¶ó‡ßç‡¶∞", author:"DQ Team", category:"Dua", language:"Bangla", pages:180, sizeMB:8.5, year:2021, downloads:7600,
        cover:"covers/dua.webp", pdf:"books/dua.pdf", tags:["Dua","Daily","Masnun"], featured:true },
      { id:5, title:"‡¶Ü‡¶≤-‡¶ï‡ßç‡¶¨‡¶ø‡¶∞‡¶æ‡¶Ü‡¶§‡ßÅ‡¶≤ ‡¶Ü‡¶∂‡¶∞‡¶æ‡¶π (‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§)", author:"Shaykh Umar", category:"Qiraat", language:"Arabic", pages:210, sizeMB:14, year:2020, downloads:1900,
        cover:"covers/qiraat.webp", pdf:"books/qiraat.pdf", tags:["Qiraat","Asharah","Advanced"] },
      { id:6, title:"Hidayatun Nahw (Arabic‚ÄìBangla Notes)", author:"Ustaza Fatima", category:"Arabic", language:"Bangla", pages:220, sizeMB:11.2, year:2024, downloads:2600,
        cover:"covers/hidayah.webp", pdf:"books/hidayah.pdf", tags:["Arabic","Nahw","Grammar"], badge:"‡¶ú‡¶®‡¶™‡ßç‡¶∞‡¶ø‡¶Ø‡¶º" },
      { id:7, title:"Selected Surahs with Tajweed", author:"DQ", category:"Quran", language:"English", pages:90, sizeMB:6.5, year:2022, downloads:3100,
        cover:"covers/surah-selected.webp", pdf:"books/surah-selected.pdf", tags:["Quran","Tajweed"] },
      { id:8, title:"‡¶π‡¶ø‡¶´‡¶Ø ‡¶™‡ßç‡¶≤‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ (‡ß©‡ß¶ ‡¶™‡¶æ‡¶∞‡¶æ)", author:"Hifz Dept.", category:"Hifz", language:"Bangla", pages:52, sizeMB:3.8, year:2025, downloads:980,
        cover:"covers/hifz-planner.webp", pdf:"books/hifz-planner.pdf", tags:["Hifz","Planner","Tracker"], badge:"‡¶®‡¶§‡ßÅ‡¶®" },
      { id:9, title:"Makharij & Sifat (Illustrated)", author:"DQ Studio", category:"Tajweed", language:"English", pages:140, sizeMB:18, year:2023, downloads:2100,
        cover:"covers/makharij.webp", pdf:"books/makharij.pdf", tags:["Makharij","Sifat","Illustration"] },
      { id:10, title:"Arabic for Kids ‚Äî Starter", author:"DQ Kids", category:"Kids", language:"Bangla", pages:80, sizeMB:5.4, year:2021, downloads:1500,
        cover:"covers/arabic-kids.webp", pdf:"books/arabic-kids.pdf", tags:["Kids","Arabic","Starter"] },
      { id:11, title:"‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶Ü‡¶Æ‡¶≤ ‚Äî Pocket", author:"DQ", category:"Dua", language:"Bangla", pages:60, sizeMB:2.1, year:2020, downloads:5200,
        cover:"covers/amal.webp", pdf:"books/amal.pdf", tags:["Dua","Daily","Pocket"] },
      { id:12, title:"Quranic Vocabulary (Roots)", author:"Arabic Dept.", category:"Arabic", language:"English", pages:160, sizeMB:9.9, year:2022, downloads:1700,
        cover:"covers/quranic-vocab.webp", pdf:"books/quranic-vocab.pdf", tags:["Arabic","Vocabulary","Roots"] },
    ];

    const state = { search:"", category:"All", language:"All", sort:"Newest", page:1, perPage:12 };
    const els = {
      search: document.getElementById('searchInput'),
      lang: document.getElementById('languageSelect'),
      sort: document.getElementById('sortSelect'),
      chips: Array.from(document.querySelectorAll('.chip')),
      grid: document.getElementById('bookGrid'),
      empty: document.getElementById('emptyState'),
      total: document.getElementById('totalCount'),
      pageInfo: document.getElementById('pageInfo'),
      prev: document.getElementById('prevBtn'),
      next: document.getElementById('nextBtn'),
      pageButtons: document.getElementById('pageButtons'),
      readerModal: document.getElementById('readerModal'),
      readerTitle: document.getElementById('readerTitle'),
      readerFrame: document.getElementById('readerFrame'),
      readerLoader: document.getElementById('readerLoader'),
      downloadFromModal: document.getElementById('downloadFromModal'),
    };

    // Events
    els.search.addEventListener('input', (e)=>{ state.search = e.target.value.trim(); state.page=1; render(); });
    els.lang.addEventListener('change', (e)=>{ state.language = e.target.value; state.page=1; render(); });
    els.sort.addEventListener('change', (e)=>{ state.sort = e.target.value; render(); });
    els.chips.forEach(ch=>{
      ch.addEventListener('click', ()=>{
        els.chips.forEach(c=>{ c.classList.remove('chip-active'); c.classList.add('chip-idle'); });
        ch.classList.add('chip-active'); ch.classList.remove('chip-idle');
        state.category = ch.dataset.category; state.page=1; render();
      });
    });

    els.prev.addEventListener('click', ()=>{ if(state.page>1){ state.page--; render(); } });
    els.next.addEventListener('click', ()=>{ const total = getFilteredBooks().length; const maxPage = Math.max(1, Math.ceil(total/state.perPage)); if(state.page<maxPage){ state.page++; render(); } });

    // Rendering
    function getFilteredBooks(){
      let list = [...books];

      // search
      if(state.search){
        const q = state.search.toLowerCase();
        list = list.filter(b => (b.title+b.author+(b.tags||[]).join(' ')).toLowerCase().includes(q));
      }
      // category
      if(state.category !== 'All'){
        list = list.filter(b => b.category === state.category);
      }
      // language
      if(state.language !== 'All'){
        list = list.filter(b => b.language === state.language);
      }
      // sort
      if(state.sort === 'Newest'){
        list.sort((a,b)=> (b.year||0) - (a.year||0));
      }else if(state.sort === 'AZ'){
        list.sort((a,b)=> a.title.localeCompare(b.title));
      }else if(state.sort === 'Popular'){
        list.sort((a,b)=> (b.downloads||0) - (a.downloads||0));
      }
      return list;
    }

    function render(){
      const list = getFilteredBooks();
      els.total.textContent = list.length;

      // pagination
      const maxPage = Math.max(1, Math.ceil(list.length / state.perPage));
      if(state.page > maxPage) state.page = maxPage;
      els.pageInfo.textContent = `${state.page}/${maxPage}`;
      els.prev.disabled = state.page <= 1;
      els.next.disabled = state.page >= maxPage;

      // page buttons
      els.pageButtons.innerHTML = '';
      const around = 2;
      const start = Math.max(1, state.page - around);
      const end = Math.min(maxPage, state.page + around);
      for(let p = start; p<=end; p++){
        const btn = document.createElement('button');
        btn.className = 'btn btn-ghost border border-emerald-500/30 ' + (p===state.page ? 'bg-white/10' : '');
        btn.textContent = p;
        btn.addEventListener('click', ()=>{ state.page = p; render(); });
        els.pageButtons.appendChild(btn);
      }

      // slice
      const startIdx = (state.page - 1) * state.perPage;
      const items = list.slice(startIdx, startIdx + state.perPage);

      els.grid.innerHTML = '';
      els.empty.classList.toggle('hidden', items.length>0);

      items.forEach(b=>{
        const card = document.createElement('div');
        card.className = "bg-gradient-to-br from-emerald-900/40 to-emerald-800/30 backdrop-blur-sm border border-emerald-500/20 rounded-2xl overflow-hidden hover:border-emerald-400/40 transition-all";
        card.innerHTML = `
          <div class="relative h-48 w-full overflow-hidden">
            <img src="${b.cover || 'covers/placeholder.webp'}" alt="${b.title}" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-[#022c22]/60 to-transparent"></div>
            ${b.badge ? `<div class="absolute top-3 left-3 badge badge-amber">${b.badge}</div>` : ''}
            ${b.featured ? `<div class="absolute top-3 right-3 badge badge-emerald">Featured</div>` : ''}
          </div>
          <div class="p-4">
            <h3 class="text-white font-semibold text-lg mb-1 line-clamp-2">${b.title}</h3>
            <p class="text-emerald-200/70 text-sm mb-3">‡¶≤‡ßá‡¶ñ‡¶ï: ${b.author}</p>
            <div class="flex flex-wrap gap-2 text-[12px] text-emerald-200/70 mb-3">
              <span>üìÑ ${b.pages} ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ</span>
              <span>‚Ä¢ üóÇÔ∏è ${b.category}</span>
              <span>‚Ä¢ üåê ${b.language}</span>
              <span>‚Ä¢ ‚¨á ${b.downloads}</span>
            </div>
            <div class="flex gap-2">
              <button class="btn btn-primary flex-1" data-read="${b.id}">‡¶™‡ßú‡ßÅ‡¶®</button>
              <a class="btn btn-ghost border-emerald-500/30" href="${b.pdf}" download>‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</a>
              <button class="btn btn-ghost border-emerald-500/30" data-wish="${b.id}" title="Wishlist">‚ô°</button>
            </div>
            ${b.tags?.length ? `<div class="mt-3 flex flex-wrap gap-1 text-[11px]">${b.tags.map(t=>`<span class="badge badge-emerald">${t}</span>`).join('')}</div>` : ''}
          </div>
        `;
        els.grid.appendChild(card);
      });

      // Bind read/wishlist events after rendering
      document.querySelectorAll('[data-read]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = +btn.dataset.read;
          const book = books.find(x=>x.id===id);
          openReader(book);
        });
      });
      document.querySelectorAll('[data-wish]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = +btn.dataset.wish;
          toggleWish(id);
          btn.textContent = isWished(id) ? '‚ù§' : '‚ô°';
        });
        // initial icon state
        const id = +btn.dataset.wish;
        btn.textContent = isWished(id) ? '‚ù§' : '‚ô°';
      });
    }

    // Wishlist (localStorage)
    const WKEY = 'dq_wishlist_books';
    function getWish(){ try{ return JSON.parse(localStorage.getItem(WKEY)) || []; }catch(e){ return []; } }
    function saveWish(list){ localStorage.setItem(WKEY, JSON.stringify(list)); }
    function isWished(id){ return getWish().includes(id); }
    function toggleWish(id){
      let list = getWish();
      if(list.includes(id)) list = list.filter(x=>x!==id); else list.push(id);
      saveWish(list);
    }

    // Reader
    function openReader(book){
      els.readerTitle.textContent = book.title;
      els.readerLoader.style.display = '';
      els.readerFrame.style.display = 'none';
      els.readerFrame.src = ''; // reset
      els.downloadFromModal.href = book.pdf;
      els.readerModal.classList.add('active');
      // Slight delay for UX
      setTimeout(()=>{
        els.readerFrame.src = `${book.pdf}#toolbar=1&navpanes=0`;
      }, 150);
    }
    document.getElementById('closeReader').addEventListener('click', closeReader);
    els.readerModal.addEventListener('click', (e)=>{ if(e.target === els.readerModal) closeReader(); });
    function closeReader(){
      els.readerModal.classList.remove('active');
      els.readerFrame.src = '';
    }
    els.readerFrame.addEventListener('load', ()=>{
      els.readerLoader.style.display = 'none';
      els.readerFrame.style.display = 'block';
    });

    // Mobile menu toggle (optional)
    const mobileBtn = document.getElementById('mobileMenuBtn');
    const mobileMenu = document.getElementById('mobileMenu');
    const menuIcon = document.getElementById('menuIcon');
    const closeIcon = document.getElementById('closeIcon');
    if(mobileBtn){
      mobileBtn.addEventListener('click', ()=>{
        const open = mobileMenu.classList.toggle('hidden');
        // toggle icons
        if(mobileMenu.classList.contains('hidden')) {
          menuIcon.classList.remove('hidden'); closeIcon.classList.add('hidden');
        } else {
          menuIcon.classList.add('hidden'); closeIcon.classList.remove('hidden');
        }
      });
    }

    // Init
    render();
  </script>
</body>
</html>